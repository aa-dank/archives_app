version: "3.9"
services:
  archives_app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    depends_on:
      - redis
    environment:
      - SMB_USERNAME=adankert
      - SMB_PASSWORD=1156DAVpass
      - SMB_DOMAIN=ppcou
      - SMB_VERSION=1.0
    command: |
      sh -c "
      service redis-server start
      mount -t cifs -o "username=adankert,password=1156DAVpass,domain=ppcou,vers=1.0" //ppdo-fs05.ppcou.ucsc.edu/Archive_Data /app/Data/Archive_Data
      mount -t cifs -o "username=adankert,password=1156DAVpass,domain=ppcou,vers=1.0" //PPDO-ACT-RECORD.ppcou.ucsc.edu/PPC_Records /app/Data/PPC_Records
      mount -t cifs -o "username=adankert,password=1156DAVpass,domain=ppcou,vers=1.0" //ppdo-fs05.ppcou.ucsc.edu/Cannon_Scans /app/Data/Cannon_Scans
      flask run --host=0.0.0.0"
    privileged: true
    cap_add:
      - SYS_ADMIN
      - SYS_RESOURCE
  redis:
    image: "redis:alpine"
